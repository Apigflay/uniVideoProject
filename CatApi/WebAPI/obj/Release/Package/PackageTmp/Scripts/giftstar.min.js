var tabIndex = 0; var StarRank = { tabIndex: 0, giftid: 0, isLoading: true, tabArrary: [{ page: 1, pageEnd: 0, total: 0, loadEnd: false }, { page: 1, pageEnd: 0, total: 0, loadEnd: false }, { page: 1, pageEnd: 0, total: 0, loadEnd: false }, { page: 1, pageEnd: 0, total: 0, loadEnd: false }, { page: 1, pageEnd: 0, total: 0, loadEnd: false }, { page: 1, pageEnd: 0, total: 0, loadEnd: false }, { page: 1, pageEnd: 0, total: 0, loadEnd: false }, { page: 1, pageEnd: 0, total: 0, loadEnd: false }, { page: 1, pageEnd: 0, total: 0, loadEnd: false }] }; StarRank.Config = { useridx: getQueryStr('useridx'), photo: getQueryStr('photo'), showtype: getQueryStr('showtype'), defaultPhoto: 'http://liveimg.9158.com/default.png' }; $(function () { StarRank.Data.LoadltwkStarData(); var a = new Date(); if ((a.getDay() == 1 && a.getHours() <= 3) || (a.getDay() == 0 && a.getHours() >= 20)) { StarRank.Data.LoadTimeData(); setInterval("StarRank.Logic.ShowTimeHtml();", 1000) } }); StarRank.Data = { LoadltwkStarData: function () { $.ajax({ timeout: 9000, type: 'POST', dataType: 'json', url: '/Rank/starRankData?datatype=1', data: { useridx: StarRank.Config.useridx }, beforeSend: function () { }, success: function (a) { StarRank.Logic.LoadStarHtml(a.data) }, error: function (a, b) { } }) }, LoadtswkStarData: function () { $.ajax({ timeout: 9000, type: 'POST', dataType: 'json', url: '/Rank/starRankData?datatype=2', data: { useridx: StarRank.Config.useridx, giftid: StarRank.giftid }, beforeSend: function () { StarRank.isLoading = true; $('.rank_body').append('<div class="loading">Loading...</div>') }, success: function (a) { StarRank.tabArrary[tabIndex].pageEnd = a.data.totalPage; StarRank.tabArrary[tabIndex].page++; if (StarRank.tabArrary[tabIndex].page > StarRank.tabArrary[tabIndex].pageEnd) { StarRank.tabArrary[tabIndex].loadEnd = true } StarRank.Logic.LoadtswkStarHtml(a.data) }, error: function (a, b) { StarRank.isLoading = false; $('.loading').remove() } }) }, LoadTimeData: function () { $.ajax({ timeout: 9000, type: 'POST', dataType: 'json', url: '/Rank/GetTime', success: function (a) { $('#time').html(a.shortTime) } }) } }; StarRank.Logic = { createLiveFlagEle: function (a) { var b = a.isOnline == 1 ? '<div class="live"><span class="livetext">直播中</span></div>' : ''; return b; return b }, LoadStarHtml: function (j) { var k = j.rankList; if (j.totalCount <= 0) { $('.nodata').css('display', 'block') } else { $.each(k, function (a, b) { var c = b.name.replace('幸运', ''); var d = (b.gender == 0) ? "female" : "male"; var e = 'level' + b.level; var f = (a == 0) ? 'block' : 'none'; var g = (a == 0) ? 'tab_sel' : ''; var h = a * 100; $('.swiper-wrapper').append('<div onclick="tabEvent(this)" id="' + a + '" data-id="' + b.giftId + '" class="swiper-slide tab_item ' + g + '">' + c + '</div>'); $('.rank_con').append('<div class="miao_rank" id="rank' + (a + 1) + '" style="left:' + h + '%;display:' + f + ';"></div>'); var i = ''; i += '<div class="item item1">' + '<a href="javascript:;" onclick="live.ShowCard(this,' + b.useridx + ')">' + '        <div class="title_star"><span class="star_name">上期' + c + '周星</span><span class="img"><img src="' + b.icon + '" /></span></div>' + '        <div class="the_img">' + '            <div class="img"></div>' + '           <div class="img_img"><img src="' + b.smallpic + '" /></div>' + '       </div>' + '       <div class="name">' + '           <span class="name_name">' + b.myname + '</span><span class="' + d + '"></span>' + '           <div class="the_level"><span class="level ' + e + '"></span><span class="num_bg bg' + live.GetGradeRank(b.grade) + '"></span><span class="num">' + b.grade + '</span></div>' + '           <div class="food">数量：' + b.totalNum + '</div>' + '      </div>' + '</a>' + '</div>' + '<div class="title_thisweek"><span>本期' + c + '排名</span></div>'; $('.miao_rank').eq(a).append(i) }) } StarRank.giftid = $('.tab .tab_item').eq(0).attr('data-id'); StarRank.Data.LoadtswkStarData(); StarRank.Logic.Module_GiftwkStar() }, LoadtswkStarHtml: function (f) { var g = f.curWeek; var h = f.myRank; $.each(g, function (a, b) { var c = (b.gender == 0) ? "female" : "male"; var d = 'level' + b.level; var e = '', icon_num = 'icon_num' + (a + 1); e += '<div class="item">' + '<a href="javascript:;" onclick="live.ShowCard(this,' + b.useridx + ')">' + '    <div class="icon ' + icon_num + '">' + (a + 1) + '</div>' + '    <div class="the_img">' + '        <div class="img"></div>' + '        <div class="img_img"><img src="' + b.smallpic + '" /></div>' + '    </div>' + '    <div class="name">' + '       <span class="name_name">' + b.myname + '</span><span class="' + c + '"></span>' + '       <div class="the_level"><span class="level ' + d + '"></span>' + '       <span class="num_bg bg' + live.GetGradeRank(b.grade) + '"></span>' + '       <span class="num">' + b.grade + '</span></div>' + '    </div>' + StarRank.Logic.createLiveFlagEle(b); +'</a>' + '</div>'; $('.miao_rank').eq(tabIndex).append(e) }); if (StarRank.Config.useridx != 0) { StarRank.Logic.LoadMyRankHtml(h) } StarRank.isLoading = false; $('.loading').remove() }, LoadMyRankHtml: function (a) { var b = '', rankValue = ''; var c = getCookie('photo'); if (a != null) { b = '第' + a.rowNo + '名'; rankValue = '数量：' + a.totalNum } else { b = '50名以后'; rankValue = '未上榜' } if (c == null) { c = StarRank.Config.photo } var d = ''; d += '<div class="self">' + '<div class="item"><a href="javascript:;">' + '<div class="icon">我</div>' + '<div class="the_img">' + '    <div class="img"></div>' + '    <div class="img_img"><img src="' + c + '" /></div>' + '</div>' + '<div class="rankText">' + b + '</div>' + '<div class="rankValue">' + rankValue + '</div>' + '</div>' + '</a></div></div></div>'; $('.miao_rank').eq(tabIndex).append(d) }, Module_GiftwkStar: function () { var a = new Swiper('.swiper-container', { pagination: '.swiper-pagination', slidesPerView: 5, paginationClickable: true, spaceBetween: 5, freeMode: true }) }, ShowTimeHtml: function () { $(".showtime").css("display", "block"); var a = new Array(); a = document.getElementById("time").innerHTML.split(':'); var b = parseInt(a[0]); var f = parseInt(a[1]); var m = parseInt(a[2]); var c, ff, mm; m = parseInt(m) + 1; if (m >= 60) { m = 0; f = parseInt(f) + 1; if (f >= 60) { f = 0; b = parseInt(b) + 1; if (b >= 24) { b = 0 } } } if (b < 10) { c = "0" + b } else { c = b } if (f < 10) { ff = "0" + f } else { ff = f } if (m < 10) { mm = "0" + m } else { mm = m } $("#time").html(c + ":" + ff + ":" + mm) } }; function tabEvent(a) { if (StarRank.isLoading == true) { return } tabIndex = a.getAttribute('id'); StarRank.giftid = a.getAttribute('data-id'); $(a).addClass('tab_sel').siblings('.tab_item').removeClass('tab_sel'); var b = -(tabIndex * 100); $('.miao_rank').eq(tabIndex).show().siblings('.miao_rank').hide(); $('#rank_con').css({ '-webkit-transform': 'translate3d(' + b + '%, 0px, 0px)', '-webkit-transition': '300ms' }); if (!StarRank.tabArrary[tabIndex].loadEnd) { StarRank.Data.LoadtswkStarData(StarRank.giftid) } }