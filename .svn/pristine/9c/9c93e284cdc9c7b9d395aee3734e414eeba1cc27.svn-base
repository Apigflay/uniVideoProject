<template>
	<!-- <view> -->
		<view class="main">
			<view class="search">
				<form @submit="formSubmit">
					<input class="section__title" id="search" type="search" v-model="search" placeholder="search" @input="check" />
				</form>
			</view>
			<!-- <view class="video"> -->
				<view class="title">
					<view :class="index==current?'tabActive':''" class="tab" v-for="(item,index) in tabledata" :key="index" :id="index" @click="changeTab">
						<text class="text">{{item.text}}</text>
					</view>
				</view>
				<scroll-view scroll-y="true" @scrolltolower="getNewmsg" class="movie">
					<view class="swiperArea">
						<view class="swiper">
							<view v-show="current == 0">
								<view class="title1">
									<text class="p">{{this.Language.language[this.tabbarLoginLanguage].language59}}</text>
								</view>
								<view class="swiper-video">
									<view class="listPer" v-for="(item,index) in model3Data" :key="index">
										<image class="img" :src="item.BackgroundPicUrl" mode="" @click="goIntoVideo(item)"></image>
										<image class="photo" :src="item.SmallPic" @click="goAnchor(item)"></image>
										<view v-if="item.Online" class="status"></view>
										<view class="text">{{item.Content}}</view>
									</view>
								</view>
							</view>
							<view v-show="current == 1">
								<!-- <view>
									<text class="title2">最近</text>
								</view> -->
								<!-- <view class="swiper-table">
									<view class="listPer" v-for="(item,index) in 1" :key="index">
										<view class="head">
											<image class="photo"></image>
											<view class="status"><text class="p">#</text></view>
										</view>
										<view class="center">
											<text class="p1">#性感</text>
											<text class="p2">1163则帖子</text>
										</view>
									</view>
								</view> -->
								<view>
									<text class="title2">{{this.Language.language[this.tabbarLoginLanguage].language59}}</text>
								</view>
								<view class="swiper-table">
									<view class="listPer" v-for="(item,index) in model1Data" :key="index" @click="goLabel(item)">
										<view class="head">
											<image class="photo" :src="item.LableUrl"></image>
											<view class="status"><text class="p">#</text></view>
										</view>
										<view class="center">
											<text class="p1">#{{item.LableName}}</text>
											<!-- <text class="p2">{{item.Count}}则帖子</text> -->
										</view>
									</view>
								</view>
							</view>
							<view v-show="current == 2">
								<view>
									<view>
										<text class="title3">{{this.Language.language[this.tabbarLoginLanguage].language223}}</text>
									</view>
									<view class="swiper-swagger">
										<view class="listPer" v-for="(item,index) in model1Data" :key="index" @click="goSwagger(item)">
											<view class="head">
												<image class="photo" :src="item.headpic"></image>
											</view>
											<view class="center">
												<view class="p1">{{item.nickname}}<view v-if="item.online" class="spot"></view></view>
												<text class="p2">{{item.signature}}</text>
											</view>
										</view>
									</view>
								</view>
							</view>
						</view>		
					</view>
				</scroll-view>
			<!-- </view> -->
			<!-- TagBar -->
			<view class="tabbarArea">
				<view class="per" v-for="(item,index) in tabbarData" :key="index" :id="index" @click="getClickPer">
					<image class="img" :src="item.imgsrcW" mode=""></image>
				</view>
			</view>
		</view>
	<!-- </view> -->
</template>

<script>
	import {encrypt,decrypt,system,systemId,base64ToArrayBuffer,sendData,sendD,work,navigateTo} from "../../lib/js/GlobalFunction.js"
	export default {
		data() {
			return {
				tabbarLoginLanguage: null, // 用户语言
				pageId: 0, // 页面ID用于页面跳转时候使用  --视频页面 标签页面 主播主页
				addressInfo: null,
				loginMsgData:null,//登录信息
				model3Data: null, // 视频页面需要的数据
				model1Data: null, // 搜索栏 内容,标签,swagger回传数据
				model2Data: null, // 向下滑动新加载的数据
				page: [1,1,1,1], // 连接接口需要的Page数据，因为有三个tab栏所以写成了数组
				modelLately:{}, // 标签中的 最近栏数据
				show_spot: true, // 是否在线的绿点
				search: '', //搜索栏input中初始的内容
				// height:1004,//页面video视频部分高度
				style:"",//顶部固定导航
				current:0,//当前activity的滑块 所搜类型
				cur: 1, //当前activity的滑块 所搜类型 tab的值
				indicatorDots: false,//指示点显示
				autoplay: false,//自动播放
				interval: 2000,//间隔
				duration: 500,//动画时长
				circular:true,//衔接
				tabledata:[
					{abc:1,text:"ค้นหาวิดีโอ"},
					{abc:2,text:"ฉลาก"},
					{abc:3,text:"ค้นหาวีเจ"}
				],
				// tabbar--
				tabbarLoginData:null,//loginMsg
				isAnchor:null,//是否为主播
				tabbarCurrent:0,//点击的索引
				tabbarData:[{imgsrcB:'../../static/imgs/room1w.png',imgsrcW:'../../static/imgs/room1w.png',text:'1'},
					{imgsrcB:'../../static/imgs/fang1w.png',imgsrcW:'../../static/imgs/fang1y.png',text:'2'},
					{imgsrcB:'../../static/imgs/mail1w.png',imgsrcW:'../../static/imgs/mail1w.png',text:'3'},
					{imgsrcB:'../../static/imgs/xin1w.png',imgsrcW:'../../static/imgs/xin1w.png',text:'4'},
					{imgsrcB:'../../static/imgs/my1w.png',imgsrcW:'../../static/imgs/my1w.png',text:'5'}],//
			};
		},
		
		onLoad() {//监听页面加载，其参数为上个页面传递的数据，参数类型为Object
				this.getLoginlanger(); // 获取语言
				this.getLoginMsg(); // 登录信息
				this.getInitMsg(); //  页面初始加载的影片群发内容的视频内容
		},
		onReachBottom(){
			// console.log("aaa")
			// this.height=this.height+750
		},
		methods:{
			getLoginlanger:function(){ // 获取当前语言
				var that = this;
				uni.getStorage({
					key: 'storage_login_language',
					success: function (res) {
						that.tabbarLoginLanguage = JSON.parse(res.data);
						// console.log(that.tabbarLoginLanguage);
					}
				});
			},
			getLoginMsg:function(){//登录信息
				var that = this;
				uni.getStorage({
					key: 'storage_login_str',
					success: function (res) {
						that.tabbarLoginData = JSON.parse(res.data);
						// console.log(that.tabbarLoginData);
						that.loginMsgData = that.tabbarLoginData
						if(that.tabbarLoginData.isAnchor==false){
							that.isAnchor = false;
						}
					}
				});
			},
			getClickPer:function(e){//tabbar click
				this.tabbarCurrent=e.currentTarget.id;
				// console.log(e.currentTarget.id)
				if(e.currentTarget.id==0){
					// console.log("首页点击")
					// uni.navigateTo({
					// 	url: '/pages/home/home'
					// });
					navigateTo('/pages/home/home',null);
				}else if(e.currentTarget.id==1){
					// console.log("搜索点击")
					// uni.navigateTo({
					// 	url: '/pages/search/search'
					// });
					navigateTo('/pages/search/search',null);
				}else if(e.currentTarget.id==2){
					// console.log("信息点击")
					// uni.navigateTo({
					// 	url: '/pages/news/news'
					// });
					navigateTo('/pages/news/news',null);
				}else if(e.currentTarget.id==3){
					// console.log("聊天点击")
					// uni.navigateTo({
					// 	url: '/pages/chat/chat'
					// });
					navigateTo('/pages/chat/chat',null);
				}else if(e.currentTarget.id==4){
					console.log(this.isAnchor)
					if(this.isAnchor==false){
						// console.log("不是主播")
						// uni.navigateTo({
						// 	url: '/pages/my/my'
						// });
						navigateTo('/pages/my/my',null);
					}else{
						// console.log("是主播")
						// uni.navigateTo({
						// 	url: '/pages/anchorme/anchorme'
						// });
						navigateTo('/pages/anchorme/anchorme',null);
					}
				}
			},
			changeTab:function(e){ // tab栏切换事件
				// console.log(e.currentTarget.id);
				this.search = ''
				this.current=e.currentTarget.id;
				if(this.current == 0)
				{
					this.cur = 1; // 搜索的类型
				}else if(this.current == 1){
					this.cur = 2;
				}else if(this.current == 2){
					this.cur = 3;
				}
				var array=base64ToArrayBuffer(encrypt(JSON.stringify({
					Where: this.search, //string
					Type: this.cur, // int
					Page: this.page[this.cur] // int
				})))
				// console.log(this.page[this.cur])
				var res = JSON.parse(decrypt(sendData('POST',this.GLOBAL.urlPoint+'/userinfo/GetSearchModel',array)));
				// console.log(res)
				if(res.code==100){
					if(this.current == 0){
						this.model3Data = res.data;
					}else if (this.current == 1){
						this.model1Data=res.data;
					}else if (this.current == 2){
						this.model1Data=res.data;
					}
					console.log(res.data)
				}
				
			},
			getInitMsg:function(e){ //页面初始化的时候群发影片中的加载内容
				var array=base64ToArrayBuffer(encrypt(JSON.stringify({
					Where: this.search, //string
					Type: 1, // int
					Page: 1 // int
				})))
				var res = JSON.parse(decrypt(sendData('POST',this.GLOBAL.urlPoint+'/userinfo/GetSearchModel',array)));
				if(res.code==100){
					this.model3Data=res.data;
					// console.log(res.data)
				}
			},
			goIntoVideo:function(e) { // 影片群发中的点击视频按钮
				// console.log(e.UserIdx) // 主播IDX
				// console.log(e.RescourceId) // 视频id
				// console.log(this.tabbarLoginData.useridx) // 当前用户IDX
				// uni.navigateTo({
				// 	url: "/pages/video/video?UserIdx="+ this.tabbarLoginData.useridx + "&AnchorIdx=" + e.UserIdx + "&ResourceoId=" + e.RescourceId + "&pageId=" + this.pageId
				// }); 
				var obj = encodeURIComponent(encrypt(JSON.stringify({
					UserIdx:this.tabbarLoginData.useridx,
					AnchorIdx:e.UserIdx,
					ResourceoId:e.RescourceId,
					pageId:this.pageId
				})))
				navigateTo('/pages/video/video',obj)
			},
			goLabel:function(e){ // 热门搜索以知标签 点击事件
				// console.log(e)
				// uni.navigateTo({
				// 	url: "/pages/tagsearch/tagsearch?searchname="+ e.LableName + "&searchCount=" + e.Count + "&pageId=" + this.pageId
				// }); 
				var obj = encodeURIComponent(encrypt(JSON.stringify({
					searchname:e.LableName,
					searchCount:e.Count,
					pageId:this.pageId
				})))
				navigateTo('/pages/tagsearch/tagsearch',obj);
			},
			goSwagger:function(e){ // 页面swagger上的内容点击后跳转的页面
			// console.log(e.useridx); // 主播IDX
			// console.log(this.loginMsgData.useridx); // 用户IDX
				// uni.navigateTo({
				// 	url: "/pages/anchorpersonal/anchorpersonal?pageId="+ this.pageId + "&AnchorIdx=" + e.useridx + "&Type=" + 2
				// }); 
				var obj = encodeURIComponent(encrypt(JSON.stringify({
					AnchorIdx:e.useridx,
					Type:2,
					pageId:this.pageId
				})))
				navigateTo('/pages/anchorpersonal/anchorpersonal',obj);
			},
			goAnchor:function(e){ // 跳转到主播信息页面
				// console.log(e)
				// uni.navigateTo({
				// 	url: "/pages/anchorpersonal/anchorpersonal?pageId="+ this.pageId + "&AnchorIdx=" + e.UserIdx + "&Type=" + 2
				// }); 
				
				var obj = encodeURIComponent(encrypt(JSON.stringify({
					AnchorIdx:e.UserIdx,
					Type:2,
					pageId:this.pageId
				})))
				navigateTo('/pages/anchorpersonal/anchorpersonal',obj);
			},
			
			getChangeMsg:function(e){ // tab栏滑动
				// console.log(this.current)
				// console.log(e.detail.current)
				this.current=e.detail.current;
				
			},
			check:function(event){ // 搜索栏输入事件
				// console.log(event.target.value)
				this.search = event.target.value // 因为下拉加载需要搜索内容所以定义
				// console.log(this.search);
				// console.log(this.cur);
				// console.log(this.page[this.cur]);
				if(this.search == ''){
					this.page[this.cur] = 1;
				}
				var array=base64ToArrayBuffer(encrypt(JSON.stringify({
					Where: String(this.search), //string
					Type: this.cur, // int
					Page: this.page[this.cur] // int
				})))
				var res = JSON.parse(decrypt(sendData('POST',this.GLOBAL.urlPoint+'/userinfo/GetSearchModel',array)));
				if(res.code==100){
					// console.log(res.data)
					if(res.code==100){
						if(this.current == 0){
							this.model3Data = res.data;
							console.log(this.model3Data)
						}else if (this.current == 1){
							this.model1Data=res.data;
						}else if (this.current == 2){
							this.model1Data=res.data;
						}
					}
				}
			},
			getNewmsg:function(){ // 下滑加载新数据
				if(this.current == 0){
					this.page[this.cur] = this.page[this.cur] +1; // 每次下滑加载后传递的Page+1
					// console.log(this.page[this.cur]);
					var array=base64ToArrayBuffer(encrypt(JSON.stringify({
						Where: this.search, //string
						Type: 1, // int
						Page: this.page[this.cur]
					})))
					var res = JSON.parse(decrypt(sendData('POST',this.GLOBAL.urlPoint+'/userinfo/GetSearchModel',array)));
					if(res.code==100){
						// console.log(res.data)
						this.model2Data=res.data;
					}
					this.model3Data.push.apply(this.model3Data,this.model2Data);
					// console.log(this.page[this.cur]);
					// console.log(this.model2Data);
				}
			},
			focus:function(){ // 搜索栏获取焦点事件
				// console.log("aaa");
			},
			blur:function(){ // 所搜栏失去焦点事件
				// console.log("bbb")
			}
			
		}
	}
</script>

<style lang="scss">
page{
	width: 100%;
	height: 100%;
	background: #191919;
}
// ---------------------------
.main{
	width: 100%;
	height: 100%;
	background-color:#191919;
	display: flex;
	flex-direction: column;
	justify-content: center;
	// ----1---
	.search{ // 搜索栏样式
		background-color:#232323;
		padding: 28rpx 28rpx 28rpx 28rpx;
		.section__title{ //搜索栏中的 input
			height: 54rpx;
			// color:#ACACAC;
			color:#FFFFFF;
			font-size: 30rpx;
			font-weight:400;
			background-color:#343434;
			border-radius: 10rpx;
			background-image: url(../../static/pictures/search_1.png);
			background-repeat: no-repeat; /*设置图片不重复*/
			background-position: left; /*图片显示的位置*/
			background-position:12rpx; // 设置图片位置
			padding-left: 70rpx; //设置搜索文字位置
			background-size: 31rpx 31rpx; // 搜索图标的大小
		}
	}
	// -----1---
	
	//------2---
	.title{// 搜索内容
				display: flex;
				justify-content:space-around;
				align-items: center;
				border-top:2rpx solid #343434;
				border-bottom:2rpx solid #343434;
				padding-left:67rpx;
				padding-right:67rpx;
				height:74rpx;
				background-color: #232323;
				z-index: 9999; // 页面tab栏 位置
				.tab{
					transition:all 0.2s;
					display: flex;
					justify-content: center;
					align-items: center;
					padding:26rpx 0 23rpx 0;
					border-bottom:2rpx solid #232323;
					.text{
						font-size: 26rpx;
						line-height: 25rpx;
						color: #707070;
						margin: 0rpx 31rpx 0rpx 31rpx;
					}
				}
				.tabActive{ // tab文字选中下划线
					box-sizing: border-box;
					border-bottom: 2rpx solid #FFFFFF;
					.text{
						color: #fff;
					}
				}
			}
	//------2---
	
	//------3---
	.movie{ // 页面 群发影片 标签 swagger tab中的内容 
				width:100%;
				z-index: 1; // 页面tab栏 位置
				background:#191919;
				overflow-y:scroll;
				// padding-bottom:90rpx;
				// height:1147rpx;
				flex:1;
				
				.swiperArea{ // 视频内容
					// width:750rpx;
					width:100%;
					// height:1004rpx;
					// padding:11rpx 0rpx 7rpx 0rpx;
					.swiper{
						.title1{ // swiper-video上方文字
							.p{
								display: block;
								margin-top:28rpx;
								margin-left: 29rpx;
								margin-bottom: 11rpx;
								color: #FFFFFF;
								font-size: 26rpx;
								font-weight: 400;
								// line-height: 25rpx;
							}
						}
						.swiper-video{ // 影片群发
							background:#191919;
							padding: 0rpx 14rpx 0rpx 28rpx;
							display: flex;
							flex:1;
							overflow-y: scroll;
							justify-content: flex-start;
							align-items: center;
							flex-wrap: wrap;
							// position:absolute;
							.listPer{
								width: 222rpx;
								height: 310rpx;
								margin-bottom: 28rpx;
								margin-right: 14rpx;
								position: relative;
								.img{
									border-radius:8rpx;
									width: 222rpx;
									height: 310rpx;
								}
								.photo{
									background: #232323;
									position: absolute;
									height: 60rpx;
									width: 60rpx;
									border:2px solid #fff;
									border-radius: 50%;
									top: 10rpx;
									left: 10rpx;
								}
								.status{
									height: 20rpx;
									width: 20rpx;
									background: #17FF2A;
									position: absolute;
									top: 55rpx;
									left: 55rpx;
									border-radius: 50%;
								}
								.text{
									position: absolute;
									width:197rpx;
									height:68rpx;
									bottom: 9rpx;
									left: 12rpx;
									font-size:22rpx;
									font-weight:400;
									color:#FFFFFF;
									line-height:34rpx;
									display: -webkit-box;
									-webkit-box-orient: vertical;
									-webkit-line-clamp: 2;
									overflow: hidden;
								}
								
							}
						}
						.title2{ // 标签列表上面的文字 最近
							// width:50rpx;
							// height: 24rpx;
							display: block;
							font-size: 26rpx;
							font-weight: 400;
							color: #FFFFFF;
							margin-top: 29rpx;
							margin-left: 29rpx;
						}
						.swiper-table{ // 标签
							margin-top: 15rpx;
							margin-left:29rpx;
							.listPer{
								height: 113rpx;
								display:flex;
								position:relative;
								.head{ // 头像
									padding: 12rpx 0rpx 11rpx 0rpx;
									height: 90rpx;
									width: 90rpx;
									position:absolute;
									.photo{ // 头像
										background: #646464;
										height: 90rpx;
										width: 90rpx;
										border-radius: 50%;
									}
									.status{ // 图片中的圆
										height: 32rpx;
										width: 32rpx;
										background: #877DF5;
										border-radius: 50%;
										position: absolute;
										top:62rpx;
										left:65rpx;
										.p{ // #号
											position: absolute;
											top:0rpx;
											left:10rpx;
											color:#FFFFFF;
											font-size: 26rpx;
											font-weight:500;
										}
									}
								}
								.center{
									// width: 600rpx;
									width: 100%;
									height:113rpx;
									border-bottom: 1rpx solid #343434;
									display: flex;
									flex-direction:column;
									justify-content:center;
									margin-left:93rpx;
									margin-right:28rpx;
									.p1{
										font-size: 26rpx;
										font-weight:500;
										// margin-top:28rpx;
										margin-left:37rpx;
										color: #FFFFFF;
									}
									.p2{
										font-size: 22rpx;
										font-weight:400;
										margin-top:10rpx;
										margin-left:38rpx;
										color:#ACACAC;
									}
								}
							}
						}
						.title3{ // swagger 内容上方文字
							display: block;
							font-size: 26rpx;
							font-weight: 400;
							color: #FFFFFF;
							margin-top: 29rpx;
							margin-left: 29rpx;
						}
						.swiper-swagger{ // swagger
							margin-top: 15rpx;
							margin-left:29rpx;
							.listPer{
								height: 113rpx;
								display:flex;
								.head{ // 头像
									padding: 12rpx 0rpx 11rpx 0rpx;
									height: 90rpx;
									width: 90rpx;
									.photo{ // 头像
										background: #646464;
										height: 90rpx;
										width: 90rpx;
										border-radius: 50%;
									}
								}
								.center{
									// width: 600rpx;
									width: 100%;
									height:113rpx;
									border-bottom: 1rpx solid #343434;
									display: flex;
									flex-direction:column;
									justify-content:center;
									margin-left:40rpx;
									margin-right:28rpx;
									.p1{
										font-size: 26rpx;
										font-weight:500;
										color: #FFFFFF;
										.spot{
											display: inline-block;
											vertical-align: middle;
											margin-left: 11rpx;
											height: 12rpx;
											width: 12rpx;
											background: #00FF2A;
											border-radius: 50%;
										}
									}
									.p2{
										font-size: 22rpx;
										font-weight:400;
										margin-top:9rpx;
										margin-right: 94rpx;
										color:#ACACAC;
										display: -webkit-box;
										-webkit-box-orient: vertical;
										-webkit-line-clamp: 1;
										overflow: hidden;
									}
								}
							}
						}
					}
				}
			}
	//------3---
	
	//------ tabbarArea ---
	.tabbarArea{
		height: 90rpx;
		width: 100%;
		// position: fixed;
		// bottom: 0;
		// left: 0;
		// z-index: 9999;
		display: flex;
		justify-content: space-around;
		align-items: center;
		background:rgba(25,25,25,1);
		.per{
			width: 54rpx;
			height: 50rpx;
			.img{
				width: 54rpx;
				height: 50rpx;
			}
		}
	}
	// ---- tabbarArea---
}

</style>
