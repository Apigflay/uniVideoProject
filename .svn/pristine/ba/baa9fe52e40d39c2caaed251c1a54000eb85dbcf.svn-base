<template>
	<scroll-view scroll-y="true" class="main" @scrolltolower="getNewmsg">
		<view class="search">
			<form @submit="formSubmit">
				<input class="section__title" id="search" type="search" placeholder="搜索" @input="check()"/>
			</form>
			<view class="cancel"><text class="font">取消</text></view>
		</view>
		<view class="content">
			<view class="list">
				<view class="listPer" v-for="(item,index) in 20" :key="index">
					<view class="left">
						<image class="photo" :src="item.BackgroundPicUrl"></image>
					</view>
					<view class="content">
						<view class="center">
							<text class="p"><text class="p1"></text>{{item.Content}}</text>
						</view>
						<view class="bottom">
							<view class="b_left">
								<image class="img" src="../../static/pictures/zuanshi_1.png"></image>
								<text class="p">剩余89小时</text>
								<image class="img" src="../../static/pictures/unlock_1.png"></image>
								<text class="p">{{item.UnLockCount}}</text>
								<image class="img" src="../../static/pictures/fabulous_1.png"></image>
								<text class="p">{{item.GoodEvaluate}}</text>
							</view>
							<view class="b_right">
								<image class="img" src="../../static/pictures/zuanshi_1.png"></image>
								<text class="p">免费</text>
							</view>
						</view>
					</view>
				</view>
			</view>
		</view>
	</scroll-view>
</template>

<script>
	import {encrypt,decrypt,system,systemId,base64ToArrayBuffer,sendData,sendD,work,regMail} from "../../lib/js/GlobalFunction.js"
	export default {
		data() {
			return {
				model1Data: null, // 获取页面信息的变量
				UserIdx: null, // 从页面获取的用户IDX
				Page: 1, // 当前页面页数
				Type: 1, //0列表 1-搜索
				Where: '', // 所搜条件
				time:89
			};
		},
		onLoad(){
			this.getLoginMsg() // 登录信息
			this.getInitMsg();
		},
		methods:{
			getLoginMsg:function(){//登录信息
				var that = this;
				uni.getStorage({
					key: 'storage_login_str',
					success: function (res) {
						that.tabbarLoginData = JSON.parse(res.data);
						// console.log(that.tabbarLoginData);
						that.UserIdx = that.tabbarLoginData.useridx
						if(that.tabbarLoginData.isAnchor==false){
							that.isAnchor = false;
						}
					}
				});
			},
			getInitMsg:function(e){ //页面初始化的时候信息加载内容
				var array=base64ToArrayBuffer(encrypt(JSON.stringify({
					UserIdx: this.UserIdx, // int 用户IDX
					Page: this.Page, // int 页面页数
					Type: this.Type, // int 类型
					Where: this.Where // string 搜索内容
				})))
				var res = JSON.parse(decrypt(sendData('POST',this.GLOBAL.urlPoint+'/userinfo/GetFansAllSearch',array)));
				console.log(res);
				if(res.code==100){
					this.model1Data = res.data.list;
				}
			},
			
			check:function(){ // 搜索栏输入事件
				this.Where = event.target.value; // 因为下拉加载需要搜索内容所以定义
				console.log(this.Where);
				
				var array=base64ToArrayBuffer(encrypt(JSON.stringify({
					UserIdx: this.UserIdx, // int 用户IDX
					Page: this.Page, // int 页面页数
					Type: this.Type, // int 类型
					Where: this.Where // string 搜索内容
				})))
				var res = JSON.parse(decrypt(sendData('POST',this.GLOBAL.urlPoint+'/userinfo/GetFansAllSearch',array)));
				console.log(res);
				if(res.code==100){
					this.model1Data = res.data.list;
				}
			},
			getNewmsg:function(){ // 页面触底时触发的事件
				console.log(this.Page);
				var array=base64ToArrayBuffer(encrypt(JSON.stringify({
					UserIdx: this.UserIdx, // int 用户IDX
					Page: this.Page++, // int 页面页数
					Type: this.Type, // int 类型
					Where: this.Where // string 搜索内容
				})))
				var res = JSON.parse(decrypt(sendData('POST',this.GLOBAL.urlPoint+'/userinfo/GetFansAllSearch',array)));
				// console.log(res);
				if(res.code==100){
					this.model1Data = res.data.list;
				}
				console.log(this.model1Data);
			}
			
		}
	}
</script>

<style lang="scss">
page{
	width: 100%;
	height: 100%;
	background: #191919;
}
.main{
	width: 100%;
	height: 100%;
	background: #191919;
	.search{ // 搜索栏样式
		width:100%;
		z-index: 9999; // 页面搜索栏 位置
		position: fixed;
		top: 0rpx;
		left: 0rpx;
		right: 0rpx;
		display: flex;
		justify-content:flex-start;
		align-items:center;
		background-color:#3B3B3B;
		padding: 23rpx 28rpx 23rpx 28rpx;
		.section__title{ //搜索栏中的 input
			width: 538rpx;
			height: 54rpx;
			color:#ACACAC;
			border-radius:8px;
			font-size: 30rpx;
			font-weight:400;
			background-color:#343434;
			background-image: url(../../static/pictures/search_1.png);
			background-repeat: no-repeat; /*设置图片不重复*/
			background-position: left; /*图片显示的位置*/
			background-position:12rpx; // 设置图片位置
			padding-left: 70rpx; //设置搜索文字位置
			background-size: 31rpx 31rpx; // 搜索图标的大小
		}
		.cancel{
			margin-left: 15rpx;
			margin-right:30rpx;
			.font{
				color: #FFFFFF;
				font-size: 30rpx;
				font-weight:400;
			}
		}
	}
	.content{ // 页面列表
		.list{
			padding-top:128rpx;
			margin-left:28rpx;
			.listPer{
				display:flex;
				border-bottom: 2px solid #343434;
				.left{ // 头像
					padding: 12rpx 0rpx 11rpx 0rpx;
					height: 90rpx;
					width: 90rpx;
					.photo{ // 头像
						background: #646464;
						height: 90rpx;
						width: 90rpx;
						border-radius: 8rpx;
					}
				}
				.content{
					width:100%;
					margin-left:39rpx;
					margin-right:28rpx;
					display:flex;
					flex-direction:column;
					justify-content: space-between;
					.center{ // 内容
						.p{ // 文字内容
							margin-top: 7rpx;
							font-size: 20rpx;
							font-weight:400;
							color:#FFFFFF;
							display: -webkit-box;
							-webkit-box-orient: vertical;
							-webkit-line-clamp: 2;
							overflow: hidden;
							.p1{
								font-size: 26rpx;
								font-weight:500;
								color: #FFFFFF;
								margin-right: 27rpx;
							}
						}
					}
					.bottom{
						width: 100%;
						display: flex;
						justify-content:space-between;
						align-items: center;
						margin-bottom: 12rpx;
						.b_left{
							display:flex;
							align-items:center;
							margin-top:11rpx;
							.img{
								width: 23rpx;
								height: 21rpx;
								margin: 0rpx 12rpx 0rpx 4rpx;
							}
							.p{
								font-size:22rpx;
								font-weight:400;
								color: #FFFFFF;
								line-height: 22rpx;
							}
						}
						.b_right{
							display:flex;
							align-items:center;
							margin-top:12rpx;
							.img{
								width: 22rpx;
								height: 16rpx;
							}
							.p{
								margin: 0rpx 1rpx 0rpx 8rpx;
								color: #FFD600;
								font-size: 20rpx;
								font-weight:400;
								line-height: 20rpx;
							}
						}
					}
				}
			}
		}
	}
}
</style>
