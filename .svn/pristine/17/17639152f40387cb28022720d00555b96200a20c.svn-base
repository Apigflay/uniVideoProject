<template>
	<view class="main">
		<view class="nav">
			<image class="back" src="../../static/imgs/more1w.png" mode="" @click="goBackPage"></image>
			<text class="title">{{AnchorName}}</text>
			<image class="add" src="../../static/pictures/gengduo1_1.png" mode="" @click="goNewAddPage"></image>
		</view>
		<scroll-view scroll-y="true" @scrolltolower="getNewlist" class="mainArea">
			<view class="listPer" v-for="(item,index) in model1Data" :key="index" @click="goVideo(item)">
				<view class="left">
					<image class="photo" :src="item.BackgroundPicUrl"></image>
				</view>
				<view class="content">
					<view class="center">
						<text class="p"><text class="p1"></text>{{item.Content}}</text>
					</view>
					<view class="bottom">
						<view class="b_left">
							<image class="img" src="../../static/pictures/bofang_1.png"></image>
							<text v-if="item.show_hours" class="p">剩余{{item.hours}}小时</text>
							<text v-if="item.show_minutes" class="p">剩余{{item.minutes}}分钟</text>
							<text v-if="item.show_seconds" class="p">剩余{{item.seconds}}秒</text>
							<image class="img" src="../../static/pictures/unlock_1.png"></image>
							<text class="p">{{item.UnLockCount}}</text>
							<image class="img" src="../../static/pictures/fabulous_1.png"></image>
							<text class="p">{{item.GoodEvaluate}}</text>
						</view>
						<!-- <view class="b_right">
							<image class="img" src="../../static/pictures/zuanshi_1.png"></image>
							<text class="p">{{item.UnLockMoney}}</text>
						</view> -->
					</view>
				</view>
			</view>
		</scroll-view>
		
		<!-- 功能 -->
		<view class="function">
			<view class="gift" @click="goGift()">
				<image class="img" src="../../static/pictures/liwu_1.png"></image>
				<text class="p">送礼</text>
			</view>
			<view class="center_line"></view>
			<view class="gift" @click="goChat()">
				<image class="img" src="../../static/pictures/chat1_1.png"></image>
				<text class="p">聊天</text>
			</view>
		</view>
		<!-- 功能 -->
	</view>
</template>

<script>
	import {encrypt,decrypt,system,systemId,base64ToArrayBuffer,sendData,sendD,work,sendD07,navigateTo} from "../../lib/js/GlobalFunction.js"
	export default {
		data() {
			return {
				nowpageid: 7, // 当前页面的页面ID
				pageId: null, // 页面ID用于页面跳转时候使用  --回退
				model1Data: null, // 获取页面信息的变量
				model2Data: null, // 页面下拉获取更新信息的变量
				UserIdx: null, // 从页面获取的用户IDX
				AnchorIdx: null, // 上一个页面获取到的主播IDX
				AnchorName: null, // 从上一个页面获取到的主播昵称
				ResourceoId: null, // 影片ID
				tabbarLoginData: null, // 存放用户登录信息
				Page: 1, // 刷新加载数据时的当前页数
				Type: 1, // 当前连接接口的类型  —0列表 1-点击主播头像获取列表
			};
		},
		
		onLoad:function(obj) {//监听页面加载，其参数为上个页面传递的数据，参数类型为Object
				var option=JSON.parse(decrypt(decodeURIComponent(obj.action)))
				// console.log(option);
				this.pageId = option.pageId; // 页面回退时使用的ID
				this.AnchorName = option.AnchorName; // 主播昵称
				this.AnchorIdx = option.AnchorIdx; // 主播IDX
				// console.log(this.AnchorName)
				this.getLoginMsg(); // 获取用户登录信息
				this.getVideo(); // 初始化页面加载用户关注主播的数据.
		},
		
		methods:{
			//---------------------------用户登录信息--------------------------------------------
			getLoginMsg:function(){ // 登录信息
				var that = this;
				uni.getStorage({
					key: 'storage_login_str',
					success: function (res) {
						that.tabbarLoginData = JSON.parse(res.data);
						// console.log(that.tabbarLoginData.useridx);
						that.UserIdx = that.tabbarLoginData.useridx;
						if(that.tabbarLoginData.isAnchor==false){
							that.isAnchor = false;
						}
					}
				});
			},
			//---------------------------用户登录信息--------------------------------------------
			
			//-----------------------点击购买主播头像跳转主播我已购买的视频列表---------------------
			getVideo:function(){
				// console.log(decrypt('UVkIwvkixFT3MFiFNKMHspgHjrhUK84gUfsshvWgbFMza3XZ/h9B1ySomcmLQnzebNiTS+D8oTa88Ul0XXfXP02TZIFwKs3wzNKsfhRezHvVgeTzcSf8B6qAOjbrq1C6'))
					// console.log(Number(this.AnchorIdx)); // 主播IDX
					// console.log({
					// 		UserIdx: this.UserIdx, // int
					// 		AnchorIdx: this.AnchorIdx, // int 主播idx 获取列表时 传0
					// 		Page: this.Page,// int
					// 		Type: this.Type // int
					// 	}); // 主播IDX
					var array=base64ToArrayBuffer(encrypt(JSON.stringify({
							UserIdx: this.UserIdx, // int
							AnchorIdx: this.AnchorIdx, // int 主播idx 获取列表时 传0
							Page: this.Page,// int
							Type: this.Type // int
						})))
						
						var res = JSON.parse(decrypt(sendData('POST',this.GLOBAL.urlPoint+'/userinfo/GetBuyList',array)));
						// console.log(res);
						if(res.code==100){
							console.log(res.data);
							this.model1Data = res.data.list;
						}
			},
			
			//-----------------------点击购买主播头像跳转主播我已购买的视频列表---------------------
			
			//------------------------滚动加载新列表---------------------------------------------
			getNewlist:function(){
					// console.log(decrypt('UVkIwvkixFT3MFiFNKMHspgHjrhUK84gUfsshvWgbFMza3XZ/h9B1ySomcmLQnzebNiTS+D8oTa88Ul0XXfXP02TZIFwKs3wzNKsfhRezHvVgeTzcSf8B6qAOjbrq1C6'))
					// console.log(Number(this.AnchorIdx)); // 主播IDX
					this.Page++;
					console.log({
							UserIdx: this.UserIdx, // int
							AnchorIdx: this.AnchorIdx, // int 主播idx 获取列表时 传0
							Page: this.Page,// int
							Type: this.Type // int
					}); // 主播IDX
					var array=base64ToArrayBuffer(encrypt(JSON.stringify({
							UserIdx: this.UserIdx, // int
							AnchorIdx: this.AnchorIdx, // int 主播idx 获取列表时 传0
							Page: this.Page,// int
							Type: this.Type // int
					})))
						
					var res = JSON.parse(decrypt(sendData('POST',this.GLOBAL.urlPoint+'/userinfo/GetBuyList',array)));
					// console.log(res);
					if(res.code==100){
						console.log(res.data);
						this.model2Data = res.data.list;
						this.model1Data.push.apply(this.model1Data,this.model2Data); // 让两个数组合并
					}
					
			},
			//------------------------滚动加载新列表---------------------------------------------
			goBackPage: function(){
				if(this.pageId == 6){
					// uni.navigateTo({
					// 	url: '/pages/anchorme/anchorme'
					// });
					navigateTo('/pages/anchorme/anchorme',null);
				}
			},
			//-----------------------跳转视频播放页面---------------------------------------------
			goVideo:function(e){
				// console.log(e)
				uni.navigateTo({
					url: "/pages/video/video?UserIdx="+ this.UserIdx + "&AnchorIdx=" + e.AnchorIdx + "&ResourceoId=" + e.ResourcesId + "&pageId=" + this.nowpageid
				});
				var obj = encodeURIComponent(encrypt(JSON.stringify({
					UserIdx:this.UserIdx,
					AnchorIdx:e.AnchorIdx,
					ResourceoId:e.ResourcesId,
					pageId:this.nowpageid
				})))
				navigateTo('/pages/video/video',obj)
			}
		}
	}
</script>

<style lang="scss">
page{
	width: 100%;
	height: 100%;
}
.main{
	width: 100%;
	height: 100%;
	background:rgba(25,25,25,1);;
	display: flex;
	flex-direction: column;
	.nav{
		height: 100rpx;
		background:rgba(37,37,37,1);
		display: flex;
		justify-content: space-between;
		align-items: center;
		.back{
			height: 36rpx;
			width: 36rpx;
			padding: 10rpx;
			margin-left: 19rpx;
		}
		.title{
			font-size:30rpx;
			color:rgba(255,255,255,1);
		}
		.add{
			height: 36rpx;
			width: 36rpx;
			padding: 10rpx;
			margin-right: 19rpx;
		}
	}
	.mainArea{
		// padding-top:7rpx;
		padding-left:28rpx;
		flex: 1;
		background:rgba(25,25,25,1);
		overflow-y:scroll;
		padding-bottom: 80rpx;
		.listPer{
			display:flex;
			border-bottom: 2px solid #343434;
			.left{ // 头像
				padding: 12rpx 0rpx 11rpx 0rpx;
				height: 90rpx;
				width: 90rpx;
				.photo{ // 头像
					background: #646464;
					height: 90rpx;
					width: 90rpx;
					border-radius: 8rpx;
				}
			}
			.content{
				width:100%;
				margin-left:39rpx;
				margin-right:28rpx;
				display:flex;
				flex-direction:column;
				justify-content: space-between;
				.center{ // 内容
					.p{ // 文字内容
						margin-top: 10rpx;
						font-size: 20rpx;
						font-weight:400;
						color:#FFFFFF;
						display: -webkit-box;
						-webkit-box-orient: vertical;
						-webkit-line-clamp: 2;
						overflow: hidden;
						.p1{
							font-size: 26rpx;
							font-weight:500;
							color: #FFFFFF;
							margin-right: 27rpx;
						}
					}
				}
				.bottom{
					width: 100%;
					display: flex;
					justify-content:space-between;
					align-items: center;
					margin-bottom: 12rpx;
					.b_left{
						display:flex;
						align-items:center;
						margin-top:11rpx;
						.img{
							width: 23rpx;
							height: 21rpx;
							margin: 0rpx 12rpx 0rpx 4rpx;
						}
						.p{
							font-size:22rpx;
							font-weight:400;
							color: #FFFFFF;
							line-height: 22rpx;
						}
					}
					.b_right{
						display:flex;
						align-items:center;
						margin-top:12rpx;
						.img{
							width: 22rpx;
							height: 16rpx;
						}
						.p{
							margin: 0rpx 1rpx 0rpx 8rpx;
							color: #FFD600;
							font-size: 20rpx;
							font-weight:400;
							line-height: 20rpx;
						}
					}
				}
			}
		}
	}
	
	.function{
		display:flex;
		justify-content:space-between;
		align-items: center;
		width: 492rpx;
		height: 80rpx;
		position: fixed;
		bottom: 0rpx;
		left: 0rpx;
		padding: 0rpx 129rpx;
		background:#252525;
		.gift{
			display:flex;
			align-items: center;
			.img{
				width:41rpx;
				height:39rpx;
			}
			.p{
				font-size:30rpx;
				color: #FFFFFF;
				margin-left: 17rpx;
			}
		}
		.center_line{
			width:2rpx;
			height:44rpx;
			background:#747474;
		}
	}
}
</style>
